---
layout: layouts/base.njk
title: making
marker: "making"
---

<style>
    /* Override base layout for full-bleed book */
    main {
        padding: 0;
        max-width: none;
        margin: 0;
    }

    /* ========================================
       Making Book - Single Scroll Snap Container
       ======================================== */

    .making-book {
        height: 100vh;
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
        overscroll-behavior: contain;
        scrollbar-width: none; /* Firefox */
    }

    /* Hide scrollbar but keep functionality */
    .making-book::-webkit-scrollbar {
        width: 0;
        background: transparent;
    }

    /* ========================================
       Spread (Unified)
       ======================================== */

    .spread {
        height: 100vh;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 4rem;
        padding: 8rem 4rem;
        align-content: center;
        box-sizing: border-box;
    }

    /* ========================================
       Header Spread (Chapter Openers)
       ======================================== */

    .spread.header-spread {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        padding-left: 8rem;
        position: relative;
    }

    .header-spread .header-links {
        position: absolute;
        top: 8rem;
        right: 4rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }

    .header-spread .search-link {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.7rem;
        letter-spacing: 0.1em;
        color: var(--ink-faint);
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .header-spread .search-link:hover {
        color: var(--bloom);
    }

    .header-spread .page-marker {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.7rem;
        color: var(--ink-faint);
    }

    .header-spread .section-label {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.6rem;
        letter-spacing: 0.15em;
        color: var(--ink-ghost);
        text-transform: uppercase;
        margin-bottom: 1.5rem;
    }

    .header-spread .page-title {
        font-size: 1.2rem;
        font-weight: 400;
        margin-bottom: 3rem;
    }

    .header-spread .page-description {
        max-width: 400px;
        margin-bottom: 3rem;
    }

    .header-spread .poem-shape {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
    }

    .header-spread .poem-line {
        font-size: 1rem;
        font-style: italic;
        color: var(--ink-light);
        line-height: 1.9;
    }

    .header-spread .poem-line:nth-child(1) { margin-left: 0; }
    .header-spread .poem-line:nth-child(2) { margin-left: 2rem; }
    .header-spread .poem-line:nth-child(3) { margin-left: 1rem; }
    .header-spread .poem-line:nth-child(4) { margin-left: 3rem; }

    .header-spread .poem-line.accident {
        color: var(--accident);
    }

    /* Filter chips */
    .filter-chips {
        display: flex;
        gap: 1.5rem;
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.7rem;
    }

    .filter-chip {
        color: var(--ink-faint);
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .filter-chip:not(.active) {
        text-decoration: underline;
        text-decoration-color: var(--ink-ghost);
        text-underline-offset: 3px;
    }

    .filter-chip:hover {
        color: var(--bloom);
    }

    .filter-chip.active {
        color: var(--ink);
        text-decoration: none;
    }

    /* Scroll hint */
    .scroll-hint {
        position: absolute;
        bottom: 4rem;
        left: 50%;
        transform: translateX(-50%);
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.65rem;
        color: var(--ink-ghost);
        text-align: center;
        opacity: 1;
        transition: opacity 0.5s ease;
    }

    .scroll-hint.hidden {
        opacity: 0;
        pointer-events: none;
    }

    /* ========================================
       Spread Content (Left Side)
       ======================================== */

    .spread-text {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .spread-poem {
        margin-bottom: 2rem;
    }

    .spread-line {
        display: block;
        font-size: 1.1rem;
        line-height: 2;
        color: var(--ink-faint);
        transition: color 0.3s ease;
    }

    .spread-line:nth-child(1) { margin-left: 0; }
    .spread-line:nth-child(2) { margin-left: 1.5rem; }
    .spread-line:nth-child(3) { margin-left: 0.75rem; }
    .spread-line:nth-child(4) { margin-left: 2.25rem; }
    .spread-line:nth-child(5) { margin-left: 0.5rem; }
    .spread-line:nth-child(6) { margin-left: 1.75rem; }
    .spread-line:nth-child(7) { margin-left: 1rem; }
    .spread-line:nth-child(8) { margin-left: 2rem; }

    .spread-poem:hover .spread-line {
        color: var(--ink-light);
    }

    .spread-line.accident {
        color: var(--accident);
    }

    .spread-meta {
        border-top: 1px solid var(--ink-ghost);
        padding-top: 1.5rem;
    }

    .spread-title {
        font-size: 0.95rem;
        font-weight: 300;
        font-style: italic;
        margin-bottom: 0.5rem;
    }

    .spread-title a {
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .spread-title a:hover {
        color: var(--bloom);
    }

    .spread-info {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.6rem;
        color: var(--ink-faint);
        line-height: 1.8;
    }

    .spread-info a {
        color: var(--ink-faint);
        text-decoration: underline;
        text-decoration-color: var(--ink-ghost);
        text-underline-offset: 2px;
    }

    .spread-info a:hover {
        color: var(--bloom);
    }

    /* Visually hidden but accessible to screen readers and LLMs */
    .spread-description {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* ========================================
       Specimen Grid (Right Side)
       ======================================== */

    .spread-specimens {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        align-self: center;
    }

    /* Single specimen: centered, constrained */
    .spread-specimens.single {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .spread-specimens.single .specimen {
        width: 100%;
        max-width: 400px;
    }

    .spread-specimens.single .specimen img {
        max-height: 60vh;
        object-fit: contain;
    }

    /* Portrait orientation: constrained height */
    .spread[data-orientation="portrait"] .spread-specimens {
        grid-template-columns: 1fr 1fr;
        max-height: 65vh;
        overflow: hidden;
    }

    .spread[data-orientation="portrait"] .specimen img {
        max-height: 30vh;
        width: auto;
        max-width: 100%;
        object-fit: contain;
        margin: 0 auto;
    }

    .specimen {
        position: relative;
        overflow: hidden;
        background: var(--paper-dark);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        /* Reset main.css .specimen container-level filter so only img-level applies */
        filter: none;
        opacity: 1;
        transition: none; /* Override main.css transition: all */
    }

    .specimen img {
        width: 100%;
        height: auto;
        display: block;
        filter: grayscale(30%);
        opacity: 0.8;
        transition: filter 0.5s ease, opacity 0.5s ease;
    }

    .specimen:hover img {
        filter: grayscale(0%);
        opacity: 1;
    }

    .specimen-num {
        position: absolute;
        bottom: 0.5rem;
        right: 0.5rem;
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.5rem;
        color: var(--bloom);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .specimen:hover .specimen-num {
        opacity: 1;
    }

    /* Interactive (iframe) specimens */
    .specimen--interactive {
        position: relative;
        overflow: hidden;
    }

    .specimen-iframe {
        width: 100%;
        height: 100%;
        min-height: 400px;
        border: none;
        display: block;
        pointer-events: none;
        filter: grayscale(30%);
        opacity: 0.8;
        transition: filter 0.5s ease, opacity 0.5s ease;
    }

    .specimen--interactive:hover .specimen-iframe {
        filter: grayscale(0%);
        opacity: 1;
    }

    .specimen-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
    }

    /* ========================================
       Position Indicator (Nav Dots)
       ======================================== */

    .book-nav {
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 0.5rem;
        z-index: 100;
    }

    .book-nav-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--ink-ghost);
        cursor: pointer;
        transition: background 0.2s ease;
        border: none;
        padding: 0;
    }

    .book-nav-dot:hover {
        background: var(--bloom);
    }

    .book-nav-dot.active {
        background: var(--ink);
    }

    .book-nav-separator {
        width: 12px;
    }

    /* ========================================
       Back Matter (Tools + Footer)
       ======================================== */

    .back-matter {
        min-height: 100vh;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: 4rem 0;
        box-sizing: border-box;
    }

    /* ========================================
       Tools Section
       ======================================== */

    .tools-section {
        padding: 6rem 4rem;
        max-width: 1200px;
        margin: 0 auto;
        border-top: 1px solid var(--ink-ghost);
    }

    .tools-label {
        font-family: 'IBM Plex Mono', monospace;
        font-size: 0.6rem;
        letter-spacing: 0.2em;
        color: var(--ink-ghost);
        text-transform: uppercase;
        margin-bottom: 2rem;
    }

    .tools-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem;
    }

    .tool-card {
        padding-top: 1rem;
        border-top: 1px solid var(--ink-ghost);
    }

    .tool-title {
        font-size: 0.9rem;
        font-weight: 400;
        margin-bottom: 0.5rem;
    }

    .tool-title a {
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .tool-title a:hover {
        color: var(--bloom);
    }

    .tool-title a.accident {
        color: var(--accident);
    }

    .tool-description {
        font-size: 0.75rem;
        color: var(--ink-light);
        line-height: 1.6;
    }

    .page-footer {
        padding: 4rem 4rem;
        border-top: 1px solid var(--ink-ghost);
    }

    /* ========================================
       Responsive
       ======================================== */

    @media (max-width: 900px) {
        .spread {
            grid-template-columns: 1fr;
            padding: 6rem 2rem;
            gap: 2rem;
        }

        .spread.header-spread {
            padding: 6rem 2rem;
        }

        .spread-specimens {
            max-width: 300px;
        }

        .tools-section {
            padding: 4rem 2rem;
        }

        .tools-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .page-footer {
            padding: 2rem;
        }
    }

    /* ========================================
       Mobile: Remove scroll-snap, simplify layout
       ======================================== */

    @media (max-width: 768px) {
        /* Remove scroll-snap behavior */
        .making-book {
            scroll-snap-type: none;
            height: auto;
            overflow-y: visible;
        }

        .spread {
            scroll-snap-align: none;
            scroll-snap-stop: normal;
            height: auto;
            min-height: auto;
            padding: 3rem 1.5rem;
            gap: 1.5rem;
        }

        .spread.header-spread {
            padding: 4rem 1.5rem 3rem;
        }

        .header-spread .header-links {
            top: 4rem;
            right: 1.5rem;
        }

        /* Hide nav dots (no function without scroll-snap) */
        .book-nav {
            display: none;
        }

        /* Hide scroll hint */
        .scroll-hint {
            display: none;
        }

        /* Stagger removed for mobile scanning */
        .spread-line:nth-child(n) {
            margin-left: 0;
        }

        .spread-poem {
            font-size: 0.95rem;
        }

        /* Images full color on mobile (no hover to earn) */
        .specimen img,
        .specimen:hover img {
            filter: none;
            opacity: 1;
        }

        .specimen-iframe,
        .specimen--interactive:hover .specimen-iframe {
            filter: none;
            opacity: 1;
        }

        /* Tools section */
        .tools-section {
            padding: 3rem 1.5rem;
        }

        .back-matter {
            min-height: auto;
            scroll-snap-align: none;
            scroll-snap-stop: normal;
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .making-book {
            scroll-behavior: auto;
        }
    }

</style>

{%- set portraitCount = collections.portraits.length -%}

<div class="making-book" id="making-book">

    <!-- ============================
         Chapter 1: Portraits
         ============================ -->

    <!-- Header Spread -->
    <section class="spread header-spread" data-spread="0" data-type="portrait" id="portraits">
        <div class="header-links">
            <a href="/search/" class="search-link">search</a>
            <span class="page-marker">002</span>
        </div>
        <h1 class="page-title">making</h1>
        <div class="section-label">PORTRAITS</div>

        <div class="page-description">
            <div class="poem-shape">
                <span class="poem-line">Prompts as poems.</span>
                <span class="poem-line">Midjourney as collaborator.</span>
                <span class="poem-line">Self-representation</span>
                <span class="poem-line accident">through machine rendering.</span>
            </div>
        </div>

        <nav class="filter-chips">
            <a href="/making/" class="filter-chip active">all</a>
            {%- for family in collections.portraitsByPrompterFamily -%}
            <a href="/making/prompter/{{ family.slug }}/" class="filter-chip">{{ family.name }}</a>
            {%- endfor -%}
        </nav>

        <div class="scroll-hint" id="scroll-hint">
            ↓ scroll to explore
        </div>
    </section>

    <!-- Portrait Spreads -->
    {%- for portrait in collections.portraits -%}
    <section class="spread" data-spread="{{ loop.index }}" data-type="portrait" data-orientation="{{ portrait.data.orientation | default('landscape') }}">

        <div class="spread-text">
            <div class="spread-poem">
                {%- for line in portrait.data.prompt -%}
                <span class="spread-line{% if line.accident %} accident{% endif %}">{{ line.text | default(line) }}</span>
                {%- endfor -%}
            </div>

            <div class="spread-meta">
                <h2 class="spread-title"><a href="{{ portrait.url }}">{{ portrait.data.title }}</a></h2>
                <div class="spread-info">
                    {{ portrait.data.generator }}{% if portrait.data.settings %} · {{ portrait.data.settings }}{% endif %}<br>
                    {% if portrait.data.prompter %}prompted by <a href="/making/prompter/{{ portrait.data.prompter | prompterFamily }}/">{{ portrait.data.prompter | prompterFamily }}</a>{% if portrait.data.prompter | prompterModel %} · <a href="/making/prompter/{{ portrait.data.prompter | prompterModel }}/">{{ portrait.data.prompter | prompterModel }}</a>{% endif %}<br>{% endif %}
                    {{ portrait.data.date | readableDate }}
                </div>
                {%- set firstPromptLine = portrait.data.prompt[0].text | default(portrait.data.prompt[0]) -%}
                {%- if portrait.data.description or firstPromptLine -%}
                <p class="spread-description">{{ portrait.data.description | default(firstPromptLine) | truncate(100) }}</p>
                {%- endif -%}
            </div>
        </div>

        <div class="spread-specimens">
            {%- for image in portrait.data.images -%}
            <figure class="specimen" data-src="{{ image.src }}">
                {% optimizedImage image.src, image.alt | default(portrait.data.title), "(max-width: 900px) 50vw, 25vw" %}
                <span class="specimen-num">{{ loop.index | string | padStart(2, '0') }}</span>
            </figure>
            {%- endfor -%}
        </div>

    </section>
    {%- endfor -%}

    <!-- ============================
         Chapter 2: Artifacts
         ============================ -->

    <!-- Artifact Header Spread -->
    <section class="spread header-spread" data-spread="{{ portraitCount + 1 }}" data-type="artifact" id="artifacts">
        <div class="section-label">ARTIFACTS</div>

        <div class="page-description">
            <div class="poem-shape">
                <span class="poem-line">The thing, not the prompt.</span>
                <span class="poem-line">SVG, code, drawing—</span>
                <span class="poem-line">made directly in conversation,</span>
                <span class="poem-line accident">not rendered elsewhere.</span>
            </div>
        </div>

        <nav class="filter-chips">
            <a href="/making/#artifacts" class="filter-chip active">all</a>
            {%- for family in collections.artifactsByCreatorFamily -%}
            <a href="/making/creator/{{ family.slug }}/" class="filter-chip">{{ family.name }}</a>
            {%- endfor -%}
        </nav>
    </section>

    <!-- Artifact Spreads -->
    {%- for artifact in collections.artifacts -%}
    <section class="spread" data-spread="{{ portraitCount + 1 + loop.index }}" data-type="artifact">

        <div class="spread-text">
            {%- if artifact.data.contextExcerpt -%}
            <div class="spread-poem">
                {%- if artifact.data.contextExcerpt.length -%}
                    {%- for line in artifact.data.contextExcerpt -%}
                    <span class="spread-line{% if line.accident %} accident{% endif %}">{{ line.text | default(line) }}</span>
                    {%- endfor -%}
                {%- else -%}
                    <span class="spread-line{% if artifact.data.contextExcerpt.accident %} accident{% endif %}">{{ artifact.data.contextExcerpt.text | default(artifact.data.contextExcerpt) }}</span>
                {%- endif -%}
            </div>
            {%- endif -%}

            <div class="spread-meta">
                <h2 class="spread-title"><a href="{{ artifact.url }}">{{ artifact.data.title }}</a></h2>
                <div class="spread-info">
                    {% if artifact.data.creator %}<a href="/making/creator/{{ artifact.data.creator | creatorFamily }}/">{{ artifact.data.creator | creatorFamily }}</a>{% if artifact.data.creator | creatorModel %} · <a href="/making/creator/{{ artifact.data.creator | slugify }}/">{{ artifact.data.creator | creatorModel }}</a>{% endif %}<br>{% endif %}
                    {{ artifact.data.medium }}{% if artifact.data.plottable %} · plottable{% endif %}<br>
                    {{ artifact.data.date | readableDate }}
                </div>
                {%- set firstContextLine = artifact.data.contextExcerpt[0].text | default(artifact.data.contextExcerpt[0]) if artifact.data.contextExcerpt else '' -%}
                {%- if artifact.data.description or firstContextLine -%}
                <p class="spread-description">{{ artifact.data.description | default(firstContextLine) | truncate(100) }}</p>
                {%- endif -%}
            </div>
        </div>

        <div class="spread-specimens{% if not artifact.data.images %} single{% endif %}">
            {% if artifact.data.images %}
            {%- for image in artifact.data.images -%}
            {% if image.src | isHTMLFile %}
            <a href="{{ artifact.url }}" class="specimen specimen--interactive">
                <iframe src="{{ image.src }}" title="{{ image.alt | default(artifact.data.title ~ ' variation ' ~ loop.index) }}" class="specimen-iframe" tabindex="-1" loading="lazy" sandbox="allow-scripts allow-same-origin"></iframe>
                <span class="specimen-overlay"></span>
                <span class="specimen-num">{{ loop.index | string | padStart(2, '0') }}</span>
            </a>
            {% else %}
            <figure class="specimen" data-src="{{ image.src }}">
                <img src="{{ image.src }}" alt="{{ image.alt | default(artifact.data.title ~ ' variation ' ~ loop.index) }}">
                <span class="specimen-num">{{ loop.index | string | padStart(2, '0') }}</span>
            </figure>
            {% endif %}
            {%- endfor -%}
            {% elif artifact.data.thumbnail %}
            <a href="{{ artifact.url }}" class="specimen">
                <img src="{{ artifact.data.thumbnail }}" alt="{{ artifact.data.title }}">
            </a>
            {% elif artifact.data.src | isHTMLFile %}
            <a href="{{ artifact.url }}" class="specimen specimen--interactive">
                <iframe src="{{ artifact.data.src }}" title="{{ artifact.data.title }}" class="specimen-iframe" tabindex="-1" loading="lazy" sandbox="allow-scripts allow-same-origin"></iframe>
                <span class="specimen-overlay"></span>
            </a>
            {% else %}
            <a href="{{ artifact.url }}" class="specimen">
                <img src="{{ artifact.data.src }}" alt="{{ artifact.data.title }}">
            </a>
            {% endif %}
        </div>

    </section>
    {%- endfor -%}

    <!-- ============================
         Back Matter: Tools + Footer
         ============================ -->

    <section class="back-matter" id="tools">
        <section class="tools-section">
            <div class="tools-label">Tools</div>
            <div class="tools-grid">
                <div class="tool-card">
                    <h3 class="tool-title"><a href="https://research-memex.org">Research Memex →</a></h3>
                    <p class="tool-description">Making human-AI research more auditable.</p>
                </div>
                <div class="tool-card">
                    <h3 class="tool-title"><a href="https://github.com/linxule/openinterviewer">Open Interviewer →</a></h3>
                    <p class="tool-description">Qualitative interviews at scale.</p>
                </div>
                <div class="tool-card">
                    <h3 class="tool-title"><a href="https://github.com/linxule/openai-assistants-discord-bot">Discord Literature Bot →</a></h3>
                    <p class="tool-description">Discord chatbot with custom knowledge bases.</p>
                </div>
            </div>
        </section>

        <section class="tools-section">
            <div class="tools-label">GPTs</div>
            <div class="tools-grid">
                <div class="tool-card">
                    <h3 class="tool-title"><a href="https://chat.openai.com/g/g-FvlPlwLn1-bertopic-navigator">BERTopic Navigator →</a></h3>
                    <p class="tool-description">Topic modeling made navigable.</p>
                </div>
                <div class="tool-card">
                    <h3 class="tool-title"><a href="https://chat.openai.com/g/g-wDUM3ows9-red-pen-scholar" class="accident">Red Pen Scholar →</a></h3>
                    <p class="tool-description">Little Red Schoolhouse writing principles.</p>
                </div>
                <div class="tool-card">
                    <h3 class="tool-title"><a href="https://chat.openai.com/g/g-pIFoLpzVx-academic-notes-assistant">Academic Notes Assistant →</a></h3>
                    <p class="tool-description">Structured notes for research.</p>
                </div>
            </div>
        </section>

        <footer class="page-footer">
            <a href="/" class="back-link">← return</a>
        </footer>
    </section>

</div>

<!-- Section Navigation -->
<nav class="book-nav" id="book-nav">
    <button class="book-nav-dot active" data-section="portraits" aria-label="Portraits"></button>
    <span class="book-nav-separator"></span>
    <button class="book-nav-dot" data-section="artifacts" aria-label="Artifacts"></button>
    <span class="book-nav-separator"></span>
    <button class="book-nav-dot" data-section="tools" aria-label="Tools"></button>
</nav>

<script>
(function() {
    const book = document.getElementById('making-book');
    const allSpreads = book.querySelectorAll('.spread');
    const dots = document.querySelectorAll('#book-nav .book-nav-dot');
    const scrollHint = document.getElementById('scroll-hint');
    const STORAGE_KEY = 'making-scroll-position';

    // Section boundaries
    const portraitCount = book.querySelectorAll('.spread[data-type="portrait"]').length;
    const artifactCount = book.querySelectorAll('.spread[data-type="artifact"]').length;
    const totalSpreads = portraitCount + artifactCount;

    // Section targets for dot clicks
    const sectionTargets = {
        portraits: document.getElementById('portraits'),
        artifacts: document.getElementById('artifacts'),
        tools: document.getElementById('tools')
    };

    // Hash navigation takes priority over scroll restore
    if (window.location.hash) {
        const target = sectionTargets[window.location.hash.slice(1)];
        if (target) {
            setTimeout(() => {
                target.scrollIntoView({ behavior: 'instant' });
            }, 0);
        }
    } else {
        const savedIndex = sessionStorage.getItem(STORAGE_KEY);
        if (savedIndex !== null) {
            const index = parseInt(savedIndex, 10);
            if (index > 0 && index < allSpreads.length) {
                setTimeout(() => {
                    allSpreads[index].scrollIntoView({ behavior: 'instant' });
                }, 0);
            }
        }
    }

    // Determine active section from scroll position
    function getActiveSection(currentIndex) {
        if (currentIndex < portraitCount) return 'portraits';
        if (currentIndex < totalSpreads) return 'artifacts';
        return 'tools';
    }

    // Scroll handler
    book.addEventListener('scroll', () => {
        const scrollPos = book.scrollTop;
        const spreadHeight = window.innerHeight;
        const currentIndex = Math.round(scrollPos / spreadHeight);

        sessionStorage.setItem(STORAGE_KEY, currentIndex.toString());

        const activeSection = getActiveSection(currentIndex);
        dots.forEach(dot => {
            dot.classList.toggle('active', dot.dataset.section === activeSection);
        });

        if (scrollPos > 50 && scrollHint) {
            scrollHint.classList.add('hidden');
        }
    });

    // Section dot click handlers
    const scrollBehavior = window.matchMedia('(prefers-reduced-motion: reduce)').matches ? 'instant' : 'smooth';
    dots.forEach(dot => {
        dot.addEventListener('click', () => {
            const target = sectionTargets[dot.dataset.section];
            if (target) {
                target.scrollIntoView({ behavior: scrollBehavior });
            }
        });
    });

})();
</script>

{% include "components/lightbox.njk" %}
